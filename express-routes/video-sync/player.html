<!DOCTYPE html>
<html>
	<head>
		<title>[room_name] - video sync</title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}

			html, body {
				overflow: hidden;
				background: #000;
			}

			video {
				width: 100vw;
				height: 100vh;
			}
		</style>
	</head>
	<body>
		<video></video>
		<script src="socket.io.js"></script>
		<script type="text/javascript">
			var socket = io("[namespace]");
			var video = document.querySelector("video");

			let actualPosition = 0;
			setInterval(()=>{
				if (!video.paused) actualPosition++;
				if (Math.abs(video.currentTime-actualPosition)>2) { // seconds
					console.log("out of sync");
					socket.emit("getInfo");
				}
			}, 1000);

			socket.on("getInfo", info=>{
				console.log(info);
				actualPosition = info.position;

				if (video.src != info.src) video.src = info.src;
				if (video.playing != info.playing) {
					if (info.playing) {
						video.play();
					} else {
						video.pause();
					}
				} 

				video.currentTime = info.position;
				video.volume = info.volume;
			});
			socket.emit("getInfo");
		</script>
	</body>
</html>